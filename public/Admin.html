<div id="debug-log" style="background:#f9f9f9; border:1px solid #ccc; padding:1rem; margin-top:1rem; display:none; white-space:pre-wrap;"></div>
<button onclick="toggleDebugLog()">Visa logg</button>
<script>
  function toggleDebugLog() {
    const log = document.getElementById('debug-log');
    log.style.display = log.style.display === 'none' ? 'block' : 'none';
  }
  function logDebug(message, data) {
    const log = document.getElementById('debug-log');
    const text = typeof data === 'object' ? JSON.stringify(data, null, 2) : data;
    log.textContent += `\n[${new Date().toLocaleTimeString()}] ${message}\n${text}\n`;
  }
</script><script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

  const supabaseClient = createClient(
    'https://pwxslkkxevuknredmfpb.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB3eHNsa2t4ZXZ1a25yZWRtZnBiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMDA1MDcsImV4cCI6MjA2MDU3NjUwN30.vWwGu6q8mJy5vX1g584qSL73V9F3bhh2RSW-2dNeEc0'
  );

  const session = (await supabaseClient.auth.getSession()).data.session;
  if (!session) window.location.href = '/login.html';
  localStorage.setItem('sb_token', session.access_token);
  document.getElementById('user-email').textContent = `Inloggad som: ${session.user.email}`;

  async function loadUsers() {
    const token = localStorage.getItem('sb_token');
    logDebug('Startar hämtning av användare...');
    try {
      const res = await fetch('/api/users', {
        headers: { 'Authorization': `Bearer ${token}` }
      });
      const data = await res.json();
      logDebug('Svar från API /api/users:', data);
      const tbody = document.querySelector('#userTable tbody');
      tbody.innerHTML = '';
      if (!data.Resources || data.Resources.length === 0) {
        logDebug('Inga användare hittades eller felaktigt format.');
        return;
      }
      data.Resources.forEach(u => {
        const row = `<tr>
          <td>${u.name?.givenName || ''} ${u.name?.familyName || ''}</td>
          <td>${u.employeeNumber || ''}</td>
          <td>${u.emails?.[0]?.value || ''}</td>
          <td>${u.department || ''}</td>
          <td>${u.manager_name || ''}</td>
          <td>${u.title || ''}</td>
          <td>${u.startDate || ''}</td>
          <td>${u.endDate || ''}</td>
          <td>
            <button onclick="editUser('${u.id}')">Edit</button>
            <button onclick="deleteUser('${u.id}')">Delete</button>
          </td>
        </tr>`;
        tbody.insertAdjacentHTML('beforeend', row);
      });
    } catch (err) {
      logDebug('Fel vid hämtning:', err);
    }
  }

  loadUsers();
</script>
